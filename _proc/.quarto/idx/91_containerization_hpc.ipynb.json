{"title":"Docker and Singularity","markdown":{"yaml":{"description":"Reproducible development environment","output-file":"containerization_hpc.html","title":"Docker and Singularity"},"headingText":"Linkage init env","containsRefs":false,"markdown":"\n\n\n\n<!-- WARNING: THIS FILE WAS AUTOGENERATED! DO NOT EDIT! -->\n\n\n### 1. In local terminal\ndocker pull statisticalgenetics/rvnpl\n\ndocker run -p 8888:8888 -v $(pwd)/Github:/home --name linkage -it statisticalgenetics/rvnpl\n\n### 2. In linkage container terminal\npip install jupyterlab\n\ncd home/\n\njupyter notebook --no-browser --port=8888 --ip='0.0.0.0' --allow-root  >>> http://127.0.0.1:8888/?token=7c88726789171627bd7144cc97c875f4d9ab2cece58a968e\n\n## Quick access\n\ndocker container start linkage\ndocker exec -it linkage /bin/bash\ncd home/\njupyter-lab --no-browser --port=8888 --ip='0.0.0.0' --allow-root \n\nhttp://127.0.0.1:8888/lab\n\n## Docker usage\nimage(the original system) >>> container\nrunning an image to a container\ndocker run -p 8888:8888 -v $(pwd)/Github:/home --name linkage -it statisticalgenetics/rvnpl\n///docker run [options] image_name\n///docker images >>> check available images\n\ncontainer options\ndocker container ls\ndocker container kill\ndocker container logs\ndocker container rename\ndocker container restart\ndocker container rm\ndocker container run\ndocker container start\ndocker container stats\ndocker container stop\n\nEntering the Docker container and using bash\n$ docker exec -it <container_id or name> /bin/bash\n\n\nremove images and container\n$ docker rmi -f <image-id>\n$ docker rm <container-id>\n\n## Packaging conda env\n\n### in rvnpl docker\n\npip install conda-pack\n\nconda create -n rvnpl_env --clone base\nconda pack -n rvnpl_env\n/get a rvnpl_env.tar.gz\ncp /usr/lib/x86_64-linux-gnu/libboost_python-py27.* /home/rvnpl_packs/\n/after unpacking, running rvnpl meet a error:ImportError: libboost_python-py27.so.1.55.0: cannot open shared object file: No such file or directory\n\n### in csg cluster\n\ncd miniconda3/envs\nmkdir rvnpl_env\ntar -xzf ~/rvnpl_env.tar.gz -C rvnpl_env\nconda-unpack\nmv libboost_python-py27.so.1.55.0 miniconda3/envs/rvnpl_env/lib/\n\nrvnpl examples work.\n\ncd example\nrvnpl collapse --fam 100extend_01.ped --vcf A1BG/rep1.vcf.gz --output ./rep1 --freq EVSMAF -c 0.01 --rvhaplo --include_vars A1BG.txt\nOR (for families with quantitative traits)\nrvnpl collapse --fam 100extend_quant.ped --vcf A1BG/rep1.vcf.gz --output ./rep1 --freq EVSMAF -c 0.01 --rvhaplo --include_vars A1BG.txt\n\nseqlink exampl doesn't work\n\nseqlink --fam seqlinkage-example.fam --vcf seqlinkage-example.vcf.gz -f MERLIN\n\nconda create -n cstatgenpy3 python=3.8\nconda activate cstatgenpy3\nconda install -c anaconda swig\nconda install -c psi4 gcc-5\npip install egglib\n\ncp /home/yh3455/miniconda3/envs/seqlink_cs100/lib/libm.so ~/miniconda3/envs/cstatgenpy3/lib/\ncp /home/yh3455/miniconda3/envs/seqlink_cs100/lib/libc.so ~/miniconda3/envs/cstatgenpy3/lib/\ncp /home/yh3455/miniconda3/envs/seqlink_cs100/lib/libpthread.so ~/miniconda3/envs/cstatgenpy3/lib/\n\ncd ~/Github/cstatgen\npython setup.py install\n\n## Singularity\n\nsingularity shell container/sifs/bioinfo.sif \n\nhttps://sylabs.io/guides/3.0/user-guide/running_services.html\n\n### Singularity pull docker image\n\n```\nmodule load Singularity\nsingularity remote login\n> enter your token\nsingularity build --remote lmm.sif docker://statisticalgenetics/lmm:3.0\n```\n\n## References\nUsing docker\nhttps://docs.docker.com/engine/reference/commandline/docker/  >>> docker\nhttps://docs.docker.com/engine/reference/commandline/container/ >>> container\n\nJupyter in container\nhttps://towardsdatascience.com/how-to-run-jupyter-notebook-on-docker-7c9748ed209f *** Basic operations\nhttps://jupyter-docker-stacks.readthedocs.io/en/latest/ \nhttps://github.com/jupyter/docker-stacks/blob/master/base-notebook/jupyter_notebook_config.py >>> c.NotebookApp.ip = \"0.0.0.0\" >>> fixed the problem to open jupyter on local computer.\nhttps://stackoverflow.com/questions/25366106/anaconda-ipython-notebook-not-starting-in-server-setup \nhttps://stackoverflow.com/questions/43692961/how-to-get-ip-address-of-running-docker-container/47226863\n\nRunning Jupyter Notebook on a remote server\nhttps://docs.anaconda.com/anaconda/user-guide/tasks/remote-jupyter-notebook/\n\nConda-Pack\nhttps://conda.github.io/conda-pack/\n"},"formats":{"html":{"execute":{"fig-width":7,"fig-height":5,"fig-format":"retina","fig-dpi":96,"df-print":"default","error":false,"eval":true,"cache":null,"freeze":false,"echo":true,"output":true,"warning":true,"include":true,"keep-md":false,"keep-ipynb":false,"ipynb":null,"enabled":false,"daemon":null,"daemon-restart":false,"debug":false,"ipynb-filters":[],"engine":"jupyter"},"render":{"keep-tex":false,"keep-yaml":false,"keep-source":false,"keep-hidden":false,"prefer-html":false,"output-divs":true,"output-ext":"html","fig-align":"default","fig-pos":null,"fig-env":null,"code-fold":"none","code-overflow":"scroll","code-link":false,"code-line-numbers":false,"code-tools":false,"tbl-colwidths":"auto","merge-includes":true,"latex-auto-mk":true,"latex-auto-install":true,"latex-clean":true,"latex-max-runs":10,"latex-makeindex":"makeindex","latex-makeindex-opts":[],"latex-tlmgr-opts":[],"latex-input-paths":[],"latex-output-dir":null,"link-external-icon":false,"link-external-newwindow":false,"self-contained-math":false,"format-resources":[]},"pandoc":{"standalone":true,"wrap":"none","default-image-extension":"png","to":"html","css":["styles.css"],"toc":true,"output-file":"containerization_hpc.html"},"language":{},"metadata":{"lang":"en","fig-responsive":true,"quarto-version":"1.0.38","theme":"cosmo","description":"Reproducible development environment","title":"Docker and Singularity"},"extensions":{"book":{"multiFile":true}}}}}