---

title: Docker and Singularity


keywords: fastai
sidebar: home_sidebar

summary: "Reproducible development environment"
description: "Reproducible development environment"
nb_path: "nbs/91_containerization_hpc.ipynb"
---
<!--

#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: nbs/91_containerization_hpc.ipynb
# command to build the docs after a change: nbdev_build_docs

-->

<div class="container" id="notebook-container">
        
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 id="Linkage-init-env">Linkage init env<a class="anchor-link" href="#Linkage-init-env"> </a></h1>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="1.-In-local-terminal">1. In local terminal<a class="anchor-link" href="#1.-In-local-terminal"> </a></h3><p>docker pull statisticalgenetics/rvnpl</p>
<p>docker run -p 8888:8888 -v $(pwd)/Github:/home --name linkage -it statisticalgenetics/rvnpl</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="2.-In-linkage-container-terminal">2. In linkage container terminal<a class="anchor-link" href="#2.-In-linkage-container-terminal"> </a></h3><p>pip install jupyterlab</p>
<p>cd home/</p>
<p>jupyter notebook --no-browser --port=8888 --ip='0.0.0.0' --allow-root  &gt;&gt;&gt; <a href="http://127.0.0.1:8888/?token=7c88726789171627bd7144cc97c875f4d9ab2cece58a968e">http://127.0.0.1:8888/?token=7c88726789171627bd7144cc97c875f4d9ab2cece58a968e</a></p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Quick-access">Quick access<a class="anchor-link" href="#Quick-access"> </a></h2>
</div>
</div>
</div>docker container start linkage
docker exec -it linkage /bin/bash
cd home/
jupyter-lab --no-browser --port=8888 --ip='0.0.0.0' --allow-root 

http://127.0.0.1:8888/lab
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Docker-usage">Docker usage<a class="anchor-link" href="#Docker-usage"> </a></h2><p>image(the original system) &gt;&gt;&gt; container
running an image to a container
docker run -p 8888:8888 -v $(pwd)/Github:/home --name linkage -it statisticalgenetics/rvnpl
///docker run [options] image_name
///docker images &gt;&gt;&gt; check available images</p>
<p>container options
docker container ls
docker container kill
docker container logs
docker container rename
docker container restart
docker container rm
docker container run
docker container start
docker container stats
docker container stop</p>
<p>Entering the Docker container and using bash
$ docker exec -it <container_id or name> /bin/bash</p>
<p>remove images and container
$ docker rmi -f &lt;image-id&gt;
$ docker rm <container-id></p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Packaging-conda-env">Packaging conda env<a class="anchor-link" href="#Packaging-conda-env"> </a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="in-rvnpl-docker">in rvnpl docker<a class="anchor-link" href="#in-rvnpl-docker"> </a></h3>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>pip install conda-pack</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>conda create -n rvnpl_env --clone base
conda pack -n rvnpl_env
/get a rvnpl_env.tar.gz
cp /usr/lib/x86_64-linux-gnu/libboost_python-py27.* /home/rvnpl_packs/
/after unpacking, running rvnpl meet a error:ImportError: libboost_python-py27.so.1.55.0: cannot open shared object file: No such file or directory</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="in-csg-cluster">in csg cluster<a class="anchor-link" href="#in-csg-cluster"> </a></h3>
</div>
</div>
</div>cd miniconda3/envs
mkdir rvnpl_env
tar -xzf ~/rvnpl_env.tar.gz -C rvnpl_env
conda-unpack
mv libboost_python-py27.so.1.55.0 miniconda3/envs/rvnpl_env/lib/
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>rvnpl examples work.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>cd example
rvnpl collapse --fam 100extend_01.ped --vcf A1BG/rep1.vcf.gz --output ./rep1 --freq EVSMAF -c 0.01 --rvhaplo --include_vars A1BG.txt
OR (for families with quantitative traits)
rvnpl collapse --fam 100extend_quant.ped --vcf A1BG/rep1.vcf.gz --output ./rep1 --freq EVSMAF -c 0.01 --rvhaplo --include_vars A1BG.txt</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>seqlink exampl doesn't work</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>seqlink --fam seqlinkage-example.fam --vcf seqlinkage-example.vcf.gz -f MERLIN</p>

</div>
</div>
</div>conda create -n cstatgenpy3 python=3.8
conda activate cstatgenpy3
conda install -c anaconda swig
conda install -c psi4 gcc-5
pip install egglib

cp /home/yh3455/miniconda3/envs/seqlink_cs100/lib/libm.so ~/miniconda3/envs/cstatgenpy3/lib/
cp /home/yh3455/miniconda3/envs/seqlink_cs100/lib/libc.so ~/miniconda3/envs/cstatgenpy3/lib/
cp /home/yh3455/miniconda3/envs/seqlink_cs100/lib/libpthread.so ~/miniconda3/envs/cstatgenpy3/lib/

cd ~/Github/cstatgen
python setup.py install
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Singularity">Singularity<a class="anchor-link" href="#Singularity"> </a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>singularity shell container/sifs/bioinfo.sif</p>
<p><a href="https://sylabs.io/guides/3.0/user-guide/running_services.html">https://sylabs.io/guides/3.0/user-guide/running_services.html</a></p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="References">References<a class="anchor-link" href="#References"> </a></h2><p>Using docker
<a href="https://docs.docker.com/engine/reference/commandline/docker/">https://docs.docker.com/engine/reference/commandline/docker/</a>  &gt;&gt;&gt; docker
<a href="https://docs.docker.com/engine/reference/commandline/container/">https://docs.docker.com/engine/reference/commandline/container/</a> &gt;&gt;&gt; container</p>
<p>Jupyter in container
<a href="https://towardsdatascience.com/how-to-run-jupyter-notebook-on-docker-7c9748ed209f">https://towardsdatascience.com/how-to-run-jupyter-notebook-on-docker-7c9748ed209f</a> *** Basic operations
<a href="https://jupyter-docker-stacks.readthedocs.io/en/latest/">https://jupyter-docker-stacks.readthedocs.io/en/latest/</a> 
<a href="https://github.com/jupyter/docker-stacks/blob/master/base-notebook/jupyter_notebook_config.py">https://github.com/jupyter/docker-stacks/blob/master/base-notebook/jupyter_notebook_config.py</a> &gt;&gt;&gt; c.NotebookApp.ip = "0.0.0.0" &gt;&gt;&gt; fixed the problem to open jupyter on local computer.
<a href="https://stackoverflow.com/questions/25366106/anaconda-ipython-notebook-not-starting-in-server-setup">https://stackoverflow.com/questions/25366106/anaconda-ipython-notebook-not-starting-in-server-setup</a> 
<a href="https://stackoverflow.com/questions/43692961/how-to-get-ip-address-of-running-docker-container/47226863">https://stackoverflow.com/questions/43692961/how-to-get-ip-address-of-running-docker-container/47226863</a></p>
<p>Running Jupyter Notebook on a remote server
<a href="https://docs.anaconda.com/anaconda/user-guide/tasks/remote-jupyter-notebook/">https://docs.anaconda.com/anaconda/user-guide/tasks/remote-jupyter-notebook/</a></p>
<p>Conda-Pack
<a href="https://conda.github.io/conda-pack/">https://conda.github.io/conda-pack/</a></p>

</div>
</div>
</div>
</div>
 

